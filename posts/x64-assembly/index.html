<!doctype html><html lang=ko dir=ltr><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>x64 Assembly 시작하기 | Pol4bear's blog</title>
<meta name=keywords content="컴파일러,어셈블러"><meta name=description content="소프트웨어가 생성되는 과정과 x64 어셈블리에 대해서 알아보자"><meta name=author content="Pol4bear"><link rel=canonical href=https://pol4bear.github.io/posts/x64-assembly/><meta name=google-site-verification content="G-73Y2WPXWJK"><link crossorigin=anonymous href=/assets/css/stylesheet.5c25c975546c048d1a5600aadb48425ae1bc921a9a18fe67d6955c9535260811.css integrity="sha256-XCXJdVRsBI0aVgCq20hCWuG8khqaGP5n1pVclTUmCBE=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://pol4bear.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://pol4bear.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://pol4bear.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://pol4bear.github.io/apple-touch-icon.png><link rel=mask-icon href=https://pol4bear.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-73Y2WPXWJK"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-73Y2WPXWJK",{anonymize_ip:!1})}</script><meta property="og:title" content="x64 Assembly 시작하기"><meta property="og:description" content="소프트웨어가 생성되는 과정과 x64 어셈블리에 대해서 알아보자"><meta property="og:type" content="article"><meta property="og:url" content="https://pol4bear.github.io/posts/x64-assembly/"><meta property="og:image" content="https://pol4bear.github.io/posts/x64-assembly/program-generation.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-07-13T09:37:00+09:00"><meta property="article:modified_time" content="2019-07-13T09:37:00+09:00"><meta property="og:site_name" content="Pol4bear's blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://pol4bear.github.io/posts/x64-assembly/program-generation.jpg"><meta name=twitter:title content="x64 Assembly 시작하기"><meta name=twitter:description content="소프트웨어가 생성되는 과정과 x64 어셈블리에 대해서 알아보자"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://pol4bear.github.io/posts/"},{"@type":"ListItem","position":3,"name":"x64 Assembly 시작하기","item":"https://pol4bear.github.io/posts/x64-assembly/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"x64 Assembly 시작하기","name":"x64 Assembly 시작하기","description":"소프트웨어가 생성되는 과정과 x64 어셈블리에 대해서 알아보자","keywords":["컴파일러","어셈블러"],"articleBody":"프로그램이 생성 및 실행되는 과정 프로그래머가 C, C++ 등의 언어로 프로그래밍을 하면 해당 언어의 컴파일러가 어셈블리 코드로 프로그램 코드를 변환한다. 어셈블러는 컴파일러가 변환한 어셈블리 코드를 오브젝트 코드로 변환한다. 링커는 어셈블러가 생성한 오브젝트 코드를 실제로 기계가 실행 가능한 바이너리 파일로 변환한다. 로더는 링커가 생성한 실행 가능한 바이너리를 메모리에 로드한다. 출처: https://www.brainkart.com/article/Assembly-and-Linking_11818/\nAssembly는 프로그래밍 언어 중 하나로써 사람이 읽기 어려운 기계어와 비교해서 사람이 읽을 수 있게 만든 한단계 위의 언어다.\n기계어가 CPU가 사용하는 ISA에 따라 달라지는 것과 같이 어셈블리 또한 통일된 규격이 없다.\nx64 프로세서에서 사용되는 어셈블리에는 문법이 두 가지로 갈린다.\nAT\u0026T 스타일과 Intel 스타일의 문법이 있는데 주소 표현 방식과 명령어 몇개에 대해서 차이가 있다.\n아래 명령어를 실행해 실행파일을 원하는 문법으로 디스어셈블해서 볼 수 있다.\nobjdump -M [intel | ATT] -d 실행파일 두가지 문법으로 같은 파일을 디스어셈블하면 두 문법의 다른점을 확인할 수 있다.\n레지스터를 참조할 때 intel 문법에서는 %를 붙이지 않는다. 두개의 인자값이 있을 때 intel 문법에서는 오른쪽 값을 왼쪽으로, ATT 문법에서는 왼쪽에서 오른쪽으로 값을 집어넣는다. 레지스터에 주소 값을 더할 때 intel 문법에서는 [레지스터+더할 주소], ATT 문법에서는 더할 주소(레지스터)로 표현한다. call, nop 등 몇가지 명령어의 이름이 다르다. Intel Assembly\nNASM 어셈블러 사용 AT\u0026T(ATT) Assembly\ngcc에 포함된 GAS(GNU Assembler) 사용 레지스터 어셈블리에서 사용되는 기본 변수 이름이다. 다른 고급 언어들과 달리 CPU에 하드웨어적으로 구현되어 있다. 이름의 변경이 불가능하다. CPU 종류 별로 레지스터의 이름이 다르다. CPU 안에 여러 레지스터들이 있고 레지스터 별로 정해진 용도가 있다. 출처: https://www.anandtech.com/show/598/5\nx64 기준 각 레지스터들의 크기는 64비트(8바이트)다. 1 바이트나 4 바이트의 데이터가 들어가면 그 레지스터에서 일정 부분만 사용하게 되는데 그 일정 부분의 레지스터 이름이 따로 있다. RAX 기준 절반인 32비트는 EAX, EAX를 반으로 나눈 16비트를 AX, AX를 반으로 나눠 8비트를 AH와 AL이라고 부른다. RBX 레지스터를 기준으로 한다면 EBX(32 bit) 다음 BX(16 bit)와 각 8 bit 크기의 BH, BL로 나눠진다. RAX, RBX, RCX, RDX의 16 bit 크기인 AX, BX, CX, DX의 높은 주소의 8 bit는 AH, BH, CH, DH라고 이름이 붙여졌지만 다른 피연산자들과 사용할 수 없다. RSI 레지스터는 ESI(32 bit), SI(16 bit), SIL(8 bit)로 나눠진다. 하지만 RAX의 AH와 다르게 SIH라는 레지스터는 없다. R8 레지스터는 R8D(32 bit), R8W(16 bit), R8B(8 bit)로 나눠진다. R15까지도 마찬가지다. 참고 자료: x64 Architecture x64 어셈블리 명령어 더 자세한 정보는 x86 and amd64 instruction reference에서 확인 가능하다.\nEflags 어셈블리 명령어에 eflag들의 값에 따라 실행되는 명령어들이 있다.\neflag들의 종류는 다음과 같다.\n출처: http://www.c-jump.com/CIS77/ASM/Instructions/lecture.html\nx64 어셈블리로 Hello World! 출력하기 리눅스에서 콘솔에 어떠한 값을 쓰려면 write syscall을 발생시켜야 하는데 syscall은 rax 레지스터 값에 따라서 호출되기 때문에 rax에 write syscall을 뜻하는 1을 집어넣는다.\nrdi에 출력할 위치를 정해주는데 표준 출력(stdout)인 1을 집어넣는다.\n출력할 문자열은 rsi에 넣어야 한다. message 심볼이 가리키는 문자열을 출력할 것이기 때문에 message 심볼에 있는 값을 rsi에 넣는다.\n각 syscall들을 사용하는 법은 여기에서 확인 가능하다. hello.asm 파일 작성\nglobal _start section .text _start: mov rax, 1 mov rdi, 1 mov rsi, message mov rdx, 14 syscall mov rax, 60 xor rdi, rdi syscall section .data message: db \"Hello, World!\", 10 hello.asm을 어셈블해서 생성된 hello.o 파일을 링킹해 hello라는 실행 파일 생성\n# hello asm을 어셈블해 오브젝트 파일을 생성한다. nasm 어셈블러가 없다면 설치 nasm -felf64 hello.asm # 생성한 오브젝트 파일인 hello.o를 링킹 과정을 거쳐 실행파일 생성 ld -o hello hello.o hello 실행파일을 디스어셈블해서 어셈블 코드 보기\nobjdump -M intel -d hello ​\t어셈블리 코드를 작성했을 때는 rax와 rdi등 64 bit의 레지스터에 값을 집어넣었는데 eax와 rdi같은 32 bit 레지스터로 변경된 것을 확인할 수 있다. 이것은 어셈블 과정에서 작은 값을 집어넣는데 64 bit를 사용하는 것을 어셈블러가 확인하고 메모리 낭비가 없도록 최적화해 준 것이다. 어셈블리 코드 설명\n_start\n엔트리 포인트를 뜻하는 기본 심볼이다.\nC언어 main 함수와 비슷한 역할을 한다.\n엔트리 포인트의 심볼 이름을 바꾸고 싶다면 코드 상에서 심볼 이름을 바꾼 후 실행파일을 생성할때 다음 명령어를 사용하면 된다.\nld -e 심볼이름 -o 실행파일이름 오브젝트파일\nglobal\nGNU 링커(ld)가 읽어낼 수 있는 심볼 이름을 선언하는 지시자다. C언어에서 컴파일에게 변수/함수의 존재를 알리기 위해 선언하는 것처럼 링커에게 알리기 위해 심볼을 선언한다고 생각하면 된다.\nglobal 외에 다른 지시자들에 대한 정보는 여기에서 확인할 수 있다.\nsection\n어셈블리어는 실행 가능한 코드, 읽기 전용 데이터 등 종류에 나눠서 섹션으로 관리한다. 사용자가 정의하는 섹션과 미리 정의되어 있는 섹션으로 나뉘는데 아래 표는 사용자가 정의하는 섹션들이다.\n그 외 섹션들의 정보는 여기에서 확인할 수 있다. 데이터를 포함하고 있는 심볼을 생성하는 법\n읽기 쓰기가 모두 가능한 심볼은 .data 섹션에 정의한다. 읽기 전용 데이터 등 다른 타입의 데이터를 정의하고 싶다면 섹션 테이블 참조 가장 앞에는 데이터를 뜻하는 심볼을 설정한다. 심볼은 해당 데이터의 주소를 가리키고 있는데 변수 이름처럼 사용 가능하다. 심볼 뒤에는 사용할 데이터의 사이즈 단위를 설정한다. 데이터 사이즈가 db면 데이터는 1바이트 단위로 저장되지만, dw라면 2바이트 단위로 저장하기 때문에 dw 사이즈 심볼에 한 바이트를 집어넣는다고 해도 뒤에 한 바이트가 더 잡힌다.\n아래 테이블에 대한 정보는 여기와 여기에서 확인 가능하다. 그 뒤에는 값을 집어 넣는데 데이터와 데이터를 이을려면 콤마(,)로 구분해서 작성한다. 문자열이 아닌 숫자를 집어넣으면 그 숫자를 아스키 코드로 인식한다. 10은 아스키코드로 newline이다. # 심볼: 데이터사이즈 데이터값 message: db \"Hello, World!\", 10 ","wordCount":"770","inLanguage":"ko","datePublished":"2019-07-13T09:37:00+09:00","dateModified":"2019-07-13T09:37:00+09:00","author":{"@type":"Person","name":"Pol4bear"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://pol4bear.github.io/posts/x64-assembly/"},"publisher":{"@type":"Organization","name":"Pol4bear's blog","logo":{"@type":"ImageObject","url":"https://pol4bear.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://pol4bear.github.io accesskey=h title="Pol4bear's blog (Alt + H)"><img src=https://pol4bear.github.io/apple-touch-icon.png alt aria-label=logo height=35>Pol4bear's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://pol4bear.github.io/categories/ title=📄카테고리><span>📄카테고리</span></a></li><li><a href=https://pol4bear.github.io/tags/ title=🔖태그><span>🔖태그</span></a></li><li><a href=https://pol4bear.github.io/search/ title="🔍검색 (Alt + /)" accesskey=/><span>🔍검색</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://pol4bear.github.io>홈</a>&nbsp;»&nbsp;<a href=https://pol4bear.github.io/posts/>Posts</a></div><h1 class=post-title>x64 Assembly 시작하기</h1><div class=post-description>소프트웨어가 생성되는 과정과 x64 어셈블리에 대해서 알아보자</div><div class=post-meta><span title='2019-07-13 09:37:00 +0900 KST'>2019년 7월 13일</span>&nbsp;·&nbsp;4 분&nbsp;·&nbsp;770 단어&nbsp;·&nbsp;Pol4bear&nbsp;|&nbsp;<a href=https://github.com/pol4bear/pol4bear.github.io/issues rel="noopener noreferrer" target=_blank>오류 제보</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>목차</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#프로그램이-생성-및-실행되는-과정>프로그램이 생성 및 실행되는 과정</a></li><li><a href=#assembly는>Assembly는</a></li><li><a href=#레지스터>레지스터</a></li><li><a href=#x64-어셈블리-명령어>x64 어셈블리 명령어</a></li></ul><ul><li><a href=#x64-어셈블리로-hello-world-출력하기>x64 어셈블리로 Hello World! 출력하기</a></li></ul></nav></div></details></div><div class=post-content><h2 id=프로그램이-생성-및-실행되는-과정>프로그램이 생성 및 실행되는 과정<a hidden class=anchor aria-hidden=true href=#프로그램이-생성-및-실행되는-과정>#</a></h2><ul><li>프로그래머가 C, C++ 등의 언어로 프로그래밍을 하면 해당 언어의 컴파일러가 어셈블리 코드로 프로그램 코드를 변환한다.</li><li>어셈블러는 컴파일러가 변환한 어셈블리 코드를 오브젝트 코드로 변환한다.</li><li>링커는 어셈블러가 생성한 오브젝트 코드를 실제로 기계가 실행 가능한 바이너리 파일로 변환한다.</li><li>로더는 링커가 생성한 실행 가능한 바이너리를 메모리에 로드한다.</li></ul><p><img loading=lazy src=program-generation.jpg alt title="Program compilation process"></p><p>출처: <a href=https://www.brainkart.com/article/Assembly-and-Linking_11818/>https://www.brainkart.com/article/Assembly-and-Linking_11818/</a></p><h2 id=assembly는>Assembly는<a hidden class=anchor aria-hidden=true href=#assembly는>#</a></h2><ul><li><p>프로그래밍 언어 중 하나로써 사람이 읽기 어려운 기계어와 비교해서 사람이 읽을 수 있게 만든 한단계 위의 언어다.</p></li><li><p>기계어가 CPU가 사용하는 <a href=http://pol4.dev/instruction-set-architecture/>ISA</a>에 따라 달라지는 것과 같이 어셈블리 또한 통일된 규격이 없다.</p></li><li><p>x64 프로세서에서 사용되는 어셈블리에는 문법이 두 가지로 갈린다.</p></li><li><p>AT&amp;T 스타일과 Intel 스타일의 문법이 있는데 주소 표현 방식과 명령어 몇개에 대해서 차이가 있다.</p></li><li><p>아래 명령어를 실행해 실행파일을 원하는 문법으로 디스어셈블해서 볼 수 있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>objdump -M <span class=o>[</span>intel <span class=p>|</span> ATT<span class=o>]</span> -d 실행파일
</span></span></code></pre></div></li><li><p>두가지 문법으로 같은 파일을 디스어셈블하면 두 문법의 다른점을 확인할 수 있다.</p><ol><li>레지스터를 참조할 때 intel 문법에서는 %를 붙이지 않는다.</li><li>두개의 인자값이 있을 때 intel 문법에서는 오른쪽 값을 왼쪽으로, ATT 문법에서는 왼쪽에서 오른쪽으로 값을 집어넣는다.</li><li>레지스터에 주소 값을 더할 때 intel 문법에서는 [레지스터+더할 주소], ATT 문법에서는 더할 주소(레지스터)로 표현한다.</li><li>call, nop 등 몇가지 명령어의 이름이 다르다.</li></ol></li><li><p>Intel Assembly</p><ul><li>NASM 어셈블러 사용</li></ul><p><img loading=lazy src=intel-assembly.png alt title="Intel assembly"></p></li><li><p>AT&amp;T(ATT) Assembly</p><ul><li>gcc에 포함된 GAS(GNU Assembler) 사용</li></ul><p><img loading=lazy src=atnt-assembly.png alt title="AT&amp;T Assembly"></p></li></ul><h2 id=레지스터>레지스터<a hidden class=anchor aria-hidden=true href=#레지스터>#</a></h2><ul><li>어셈블리에서 사용되는 기본 변수 이름이다.</li><li>다른 고급 언어들과 달리 CPU에 하드웨어적으로 구현되어 있다.</li><li>이름의 변경이 불가능하다.</li><li>CPU 종류 별로 레지스터의 이름이 다르다.</li><li>CPU 안에 여러 레지스터들이 있고 레지스터 별로 정해진 용도가 있다.</li></ul><p><img loading=lazy src=x64-register.jpg alt title="x64 Register"></p><p>출처: <a href=https://www.anandtech.com/show/598/5>https://www.anandtech.com/show/598/5</a></p><ul><li>x64 기준 각 레지스터들의 크기는 64비트(8바이트)다. 1 바이트나 4 바이트의 데이터가 들어가면 그 레지스터에서 일정 부분만 사용하게 되는데 그 일정 부분의 레지스터 이름이 따로 있다.</li><li>RAX 기준 절반인 32비트는 EAX, EAX를 반으로 나눈 16비트를 AX, AX를 반으로 나눠 8비트를 AH와 AL이라고 부른다.</li><li>RBX 레지스터를 기준으로 한다면 EBX(32 bit) 다음 BX(16 bit)와 각 8 bit 크기의 BH, BL로 나눠진다.</li><li>RAX, RBX, RCX, RDX의 16 bit 크기인 AX, BX, CX, DX의 높은 주소의 8 bit는 AH, BH, CH, DH라고 이름이 붙여졌지만 다른 피연산자들과 사용할 수 없다.</li><li>RSI 레지스터는 ESI(32 bit), SI(16 bit), SIL(8 bit)로 나눠진다. 하지만 RAX의 AH와 다르게 SIH라는 레지스터는 없다.</li><li>R8 레지스터는 R8D(32 bit), R8W(16 bit), R8B(8 bit)로 나눠진다. R15까지도 마찬가지다.</li><li>참고 자료: <a href=https://docs.microsoft.com/ko-kr/windows-hardware/drivers/debugger/x64-architecture>x64 Architecture</a></li></ul><p><img loading=lazy src=register.png alt title="Register types"></p><h2 id=x64-어셈블리-명령어>x64 어셈블리 명령어<a hidden class=anchor aria-hidden=true href=#x64-어셈블리-명령어>#</a></h2><p>더 자세한 정보는 <a href=https://www.felixcloutier.com/x86/>x86 and amd64 instruction reference</a>에서 확인 가능하다.</p><h1 id=eflags>Eflags<a hidden class=anchor aria-hidden=true href=#eflags>#</a></h1><ul><li><p>어셈블리 명령어에 eflag들의 값에 따라 실행되는 명령어들이 있다.</p></li><li><p>eflag들의 종류는 다음과 같다.</p><p><img loading=lazy src=eflags.png alt title=Eflags></p><p>출처: <a href=http://www.c-jump.com/CIS77/ASM/Instructions/lecture.html>http://www.c-jump.com/CIS77/ASM/Instructions/lecture.html</a></p></li></ul><h2 id=x64-어셈블리로-hello-world-출력하기>x64 어셈블리로 Hello World! 출력하기<a hidden class=anchor aria-hidden=true href=#x64-어셈블리로-hello-world-출력하기>#</a></h2><ul><li><p>리눅스에서 콘솔에 어떠한 값을 쓰려면 write syscall을 발생시켜야 하는데 syscall은 rax 레지스터 값에 따라서 호출되기 때문에 rax에 write syscall을 뜻하는 1을 집어넣는다.</p></li><li><p>rdi에 출력할 위치를 정해주는데 표준 출력(stdout)인 1을 집어넣는다.</p></li><li><p>출력할 문자열은 rsi에 넣어야 한다. message 심볼이 가리키는 문자열을 출력할 것이기 때문에 message 심볼에 있는 값을 rsi에 넣는다.</p><ul><li>각 syscall들을 사용하는 법은 <a href=https://syscalls.kernelgrok.com/>여기</a>에서 확인 가능하다.</li></ul></li></ul><ol><li><p>hello.asm 파일 작성</p><pre tabindex=0><code class=language-assembly data-lang=assembly>global _start

section .text
_start:
    mov rax, 1
    mov rdi, 1
    mov rsi, message
    mov rdx, 14
    syscall
    mov rax, 60
    xor rdi, rdi
    syscall

section .data
message: db &#34;Hello, World!&#34;, 10
</code></pre></li><li><p>hello.asm을 어셈블해서 생성된 hello.o 파일을 링킹해 hello라는 실행 파일 생성</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># hello asm을 어셈블해 오브젝트 파일을 생성한다. nasm 어셈블러가 없다면 설치</span>
</span></span><span class=line><span class=cl>nasm -felf64 hello.asm
</span></span><span class=line><span class=cl><span class=c1># 생성한 오브젝트 파일인 hello.o를 링킹 과정을 거쳐 실행파일 생성</span>
</span></span><span class=line><span class=cl>ld -o hello hello.o
</span></span></code></pre></div></li><li><p>hello 실행파일을 디스어셈블해서 어셈블 코드 보기</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>objdump -M intel -d hello
</span></span></code></pre></div></li></ol><p>​ <img loading=lazy src=assembly-hello-world.png alt title="Hello, world! in Assembly"></p><ol start=4><li>어셈블리 코드를 작성했을 때는 rax와 rdi등 64 bit의 레지스터에 값을 집어넣었는데 eax와 rdi같은 32 bit 레지스터로 변경된 것을 확인할 수 있다. 이것은 어셈블 과정에서 작은 값을 집어넣는데 64 bit를 사용하는 것을 어셈블러가 확인하고 메모리 낭비가 없도록 최적화해 준 것이다.</li></ol><ul><li><p>어셈블리 코드 설명</p><ul><li><p>_start</p><ul><li><p>엔트리 포인트를 뜻하는 기본 심볼이다.</p></li><li><p>C언어 main 함수와 비슷한 역할을 한다.</p></li><li><p>엔트리 포인트의 심볼 이름을 바꾸고 싶다면 코드 상에서 심볼 이름을 바꾼 후 실행파일을 생성할때 다음 명령어를 사용하면 된다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell></code></pre></div></li></ul><p>ld -e 심볼이름 -o 실행파일이름 오브젝트파일</p><pre tabindex=0><code></code></pre></li><li><p>global</p><ul><li>GNU 링커(ld)가 읽어낼 수 있는 심볼 이름을 선언하는 지시자다.</li></ul></li><li><p>C언어에서 컴파일에게 변수/함수의 존재를 알리기 위해 선언하는 것처럼 링커에게 알리기 위해 심볼을 선언한다고 생각하면 된다.</p></li></ul></li><li><p>global 외에 다른 지시자들에 대한 정보는 <a href=http://korea.gnu.org/manual/release/as/as-ko_7.html>여기</a>에서 확인할 수 있다.</p><ul><li><p>section</p><ul><li>어셈블리어는 실행 가능한 코드, 읽기 전용 데이터 등 종류에 나눠서 섹션으로 관리한다.</li></ul></li><li><p>사용자가 정의하는 섹션과 미리 정의되어 있는 섹션으로 나뉘는데 아래 표는 사용자가 정의하는 섹션들이다.</p><ul><li>그 외 섹션들의 정보는 <a href=https://docs.oracle.com/cd/E19455-01/806-3773/elf-3/index.html>여기</a>에서 확인할 수 있다.</li></ul></li></ul><ul><li><p>데이터를 포함하고 있는 심볼을 생성하는 법</p><ul><li>읽기 쓰기가 모두 가능한 심볼은 .data 섹션에 정의한다.</li><li>읽기 전용 데이터 등 다른 타입의 데이터를 정의하고 싶다면 섹션 테이블 참조</li><li>가장 앞에는 데이터를 뜻하는 심볼을 설정한다. 심볼은 해당 데이터의 주소를 가리키고 있는데 변수 이름처럼 사용 가능하다.</li></ul></li><li><p>심볼 뒤에는 사용할 데이터의 사이즈 단위를 설정한다. 데이터 사이즈가 db면 데이터는 1바이트 단위로 저장되지만, dw라면 2바이트 단위로 저장하기 때문에 dw 사이즈 심볼에 한 바이트를 집어넣는다고 해도 뒤에 한 바이트가 더 잡힌다.</p><ul><li>아래 테이블에 대한 정보는 <a href=https://nasm.us/doc/nasmdoc3.html>여기</a>와 <a href=http://www.tortall.net/projects/yasm/manual/html/nasm-pseudop.html>여기</a>에서 확인 가능하다.</li></ul><ul><li>그 뒤에는 값을 집어 넣는데 데이터와 데이터를 이을려면 콤마(,)로 구분해서 작성한다.</li><li>문자열이 아닌 숫자를 집어넣으면 그 숫자를 아스키 코드로 인식한다. 10은 아스키코드로 newline이다.</li></ul><pre tabindex=0><code class=language-assembly data-lang=assembly># 심볼: 데이터사이즈 데이터값
message: db &#34;Hello, World!&#34;, 10
</code></pre></li></ul></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://pol4bear.github.io/tags/%EC%BB%B4%ED%8C%8C%EC%9D%BC%EB%9F%AC/>컴파일러</a></li><li><a href=https://pol4bear.github.io/tags/%EC%96%B4%EC%85%88%EB%B8%94%EB%9F%AC/>어셈블러</a></li></ul><nav class=paginav><a class=prev href=https://pol4bear.github.io/posts/linux-kernel-compile-and-install/><span class=title>« 이전 페이지</span><br><span>Linux 커널 컴파일 및 설치</span>
</a><a class=next href=https://pol4bear.github.io/posts/computer-architecture/><span class=title>다음 페이지 »</span><br><span>컴퓨터 구조</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share x64 Assembly 시작하기 on x" href="https://x.com/intent/tweet/?text=x64%20Assembly%20%ec%8b%9c%ec%9e%91%ed%95%98%ea%b8%b0&amp;url=https%3a%2f%2fpol4bear.github.io%2fposts%2fx64-assembly%2f&amp;hashtags=%ec%bb%b4%ed%8c%8c%ec%9d%bc%eb%9f%ac%2c%ec%96%b4%ec%85%88%eb%b8%94%eb%9f%ac"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share x64 Assembly 시작하기 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fpol4bear.github.io%2fposts%2fx64-assembly%2f&amp;title=x64%20Assembly%20%ec%8b%9c%ec%9e%91%ed%95%98%ea%b8%b0&amp;summary=x64%20Assembly%20%ec%8b%9c%ec%9e%91%ed%95%98%ea%b8%b0&amp;source=https%3a%2f%2fpol4bear.github.io%2fposts%2fx64-assembly%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share x64 Assembly 시작하기 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fpol4bear.github.io%2fposts%2fx64-assembly%2f&title=x64%20Assembly%20%ec%8b%9c%ec%9e%91%ed%95%98%ea%b8%b0"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share x64 Assembly 시작하기 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fpol4bear.github.io%2fposts%2fx64-assembly%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share x64 Assembly 시작하기 on whatsapp" href="https://api.whatsapp.com/send?text=x64%20Assembly%20%ec%8b%9c%ec%9e%91%ed%95%98%ea%b8%b0%20-%20https%3a%2f%2fpol4bear.github.io%2fposts%2fx64-assembly%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share x64 Assembly 시작하기 on telegram" href="https://telegram.me/share/url?text=x64%20Assembly%20%ec%8b%9c%ec%9e%91%ed%95%98%ea%b8%b0&amp;url=https%3a%2f%2fpol4bear.github.io%2fposts%2fx64-assembly%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share x64 Assembly 시작하기 on ycombinator" href="https://news.ycombinator.com/submitlink?t=x64%20Assembly%20%ec%8b%9c%ec%9e%91%ed%95%98%ea%b8%b0&u=https%3a%2f%2fpol4bear.github.io%2fposts%2fx64-assembly%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></div></footer><script src=https://utteranc.es/client.js repo=pol4bear/blog-comments issue-term=pathname theme=github-dark crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=https://pol4bear.github.io>Pol4bear's blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>